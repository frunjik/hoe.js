<!DOCTYPE html>  <html> <head>   <title>app.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global location, localStorage, $, hoe */</span>
<span class="cm">/*global input, label, button, ul, li, div, h1, section, header, footer, strong, a, span */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>hoe.js Tutorial - TodoMVC</h1>

<p>In this tutorial we will create a simple TODO application,
it is based on <a href="http://todomvc.com/">http://todomvc.com/</a>.
You can take a look at the full <a href="https://github.com/addyosmani/todomvc/wiki/App-Specification">specification</a> - but not required.</p>

<p>Before we start you can play with it <a href="../sample_todomvc/index.html">here</a>.</p>

<p>To run locally grab the source files for HTML, CSS and other dependencies
from the <a href="https://github.com/schettino72/hoe.js/tree/gh-pages/sample_todomvc">github repo</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nb">window</span> <span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">ENTER_KEY</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>hoe initialization</h2>

<p>first call <code>hoe.init()</code> to define shorthand functions to
create HTML elements in the global namespace like <code>div()</code>,
<code>span()</code>, <code>a()</code>...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hoe</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>TodoItem</h2>

<p>Let's start writing code for a TodoItem,
our goal is to write it as a "component".</p>

<p>It probably wont be re-used in any other place than
a TODO application, anyway this helps us structure the
the code in an easy way to understand and modify.</p>

<h3>constructor</h3>

<p>An item has 3 properties: <code>id</code>, <code>title</code> and <code>completed</code>.
The TodoItem is created inheriting from <code>hoe.Type</code> so
it has some extra features.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">TodoItem</span> <span class="o">=</span> <span class="nx">hoe</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">completed</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="o">=</span> <span class="nx">completed</span><span class="p">;</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>render</h3>

<p><code>hoe.js</code> approach is that HTML for "widgets" should be created
directly by javascript.</p>

<p>But shouldn't we separate the presentation from the logic with templates?
Well, using templates you would typically need to reference
mostly every element by <code>id</code> or <code>class</code> in order to attach events
and modify the element. So how much separation are you really getting
from this? Anyway, it is possible to use templates if you wish...</p>

<p>Creating HTML from js lets us simplify by keeping all the code in a single
location and avoid problems like referencing elements by name that might
have changed, have a typo or are simply hard to locate.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <ul>
<li>create the <em>input</em> element for the checkbox calling the function
with the tag name</li>
<li>HTML attributes are passed as plain objects</li>
<li>the returned value is a jQuery object</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$checkbox</span> <span class="o">=</span> <span class="nx">input</span><span class="p">({</span> <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;toggle&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;checkbox&#39;</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>set the checkbox according to the instance value using jQuery method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$checkbox</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Whenever a TodoItem is marked or unmarked as completed we need
to update our object's data, so let's attach an event handler.</p>

<p>The standard way to attach callbacks to events is to use the
method <code>listen</code>. This method is similar with jQuery's <code>on</code> and
<code>bind</code>. The difference is that this method
belongs to the TodoItem object and the callback will be automatically
executed on the object scope (no need to use <code>$.proxy</code>).</p>

<p>the arguments are:</p>

<ul>
<li>the jQuery/DOM element that generates the event</li>
<li>the event name</li>
<li>the callback -> (will be implemented later)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$checkbox</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggleCompleted</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Create <em>label</em> for checkbox with todo title and attach a
method to start editing on double click event.</p>

<p>Before we saw how plain objects are used to set HTML
attributes for a tag being created. If you pass a <em>String</em>
it will be append in the content of the element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$label</span> <span class="o">=</span> <span class="nx">label</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$label</span><span class="p">,</span> <span class="s1">&#39;dblclick&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">startEdit</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Create <em>button</em> to remove the TodoItem.
When a todo item is deleted it needs to be removed from
the TodoApp. Since the TodoItem has no knowlodge of
where it is contained it will just tigger/fire an event,
so that the container can act uppon it.</p>

<p>The fire method's first argument is the name of the event.
All other arguments will be passed to the callback attached
as event handler, here we just pass a reference to the TodoItem
being deleted.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">$button</span> <span class="o">=</span> <span class="nx">button</span><span class="p">({</span> <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;destroy&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">$button</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span> <span class="p">}</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Here we create the <em>input</em> element to be used when the title
of the TodoItem is being edited.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">({</span> <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">,</span> <span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateTitle</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">,</span> <span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateTitle</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Now we just need to put all the elements together.
Note how we combine different arguments, plain object for
HTML attributes, DOM elements are appended to the content.
You can pass as many arguments as you wish.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">$view</span> <span class="o">=</span> <span class="nx">div</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;view&#39;</span><span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">$checkbox</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$label</span><span class="p">,</span> <span class="nx">$button</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$ele</span> <span class="o">=</span> <span class="nx">li</span><span class="p">(</span> <span class="nx">$view</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>And finally set a class to apply a CSS style.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Event handlers</h3>

<p>Now we need to create the methods used as event handlers for each operation.</p>

<p><code>startEdit</code> will display the input element (done through CSS,
so just change the <code>class</code> attribute).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startEdit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;editing&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>updateTitle</code> when finished editing.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateTitle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;blur&#39;</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="nx">ENTER_KEY</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>update the Object property</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>update the UI</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">$label</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;editing&#39;</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>notify the container element triggering an event</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span> <span class="s1">&#39;updated&#39;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><code>toggleCompleted</code>, about the same steps.
Update the object property, update the UI and trigger an event to
notify the container.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoItem</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleCompleted</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">completed</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$checkbox</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;checked&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span> <span class="s1">&#39;completed&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span> <span class="s1">&#39;toggle&#39;</span><span class="p">,</span> <span class="k">this</span> <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>TodoApp</h2>

<p>The TodoApp will follow the same pattern.
The constructor defines the object properties, the initial data
is loaded from LocalStorage.
The URL hash can be used to set the initial "view filter".</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">TodoApp</span> <span class="o">=</span> <span class="nx">hoe</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>dict of TodoItem by id</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>helper to generate TodoItem id's</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">next_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>computed values. keep track of number of TodoItem's and completed</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>current value of the UI filter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">filter_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">null</span> <span class="p">},</span>
              <span class="s1">&#39;active&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Active&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
              <span class="s1">&#39;completed&#39;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Completed&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}};</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Initialization: load data from LocalStorage</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>read hash from URL to set initial filter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">hashChanged</span><span class="p">();</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>render</h3>

<p>create HTMl elements and attach events</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>the input element where new TodoItem can be added</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;new-todo&#39;</span><span class="p">,</span> <span class="nx">placeholder</span><span class="o">:</span> <span class="s1">&#39;What needs to be done?&#39;</span><span class="p">,</span> <span class="nx">autofocus</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">,</span> <span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">addItemCallback</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>checkbox to toggle all Todo's at once</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span> <span class="o">=</span> <span class="nx">input</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span><span class="s1">&#39;toggle-all&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;checkbox&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggleAll</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">$label</span> <span class="o">=</span> <span class="nx">label</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;for&#39;</span><span class="o">:</span> <span class="s1">&#39;toggle-all&#39;</span> <span class="p">},</span> <span class="s1">&#39;Mark all as complete&#39;</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>the container for the TodoItem's HTML</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span> <span class="o">=</span> <span class="nx">ul</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span><span class="s1">&#39;todo-list&#39;</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>assemble the main section</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$main</span> <span class="o">=</span> <span class="nx">section</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">,</span> <span class="nx">$label</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>create the footer</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$todoCount</span> <span class="o">=</span> <span class="nx">span</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;todo-count&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$filters</span> <span class="o">=</span> <span class="nx">ul</span><span class="p">(</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;filters&#39;</span> <span class="p">}</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>A separate function was defined to create the HTML
for the filters.</p>

<p>the <code>forEach</code> method from <code>hoe.Type</code> will iterate through
the items of an array/object and pass them as a parameter
to a function. The function will automatically keep the scope
in the object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">filter_opts</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render_filter</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$clear</span> <span class="o">=</span> <span class="nx">button</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;clear-completed&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$clear</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">clearCompleted</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span> <span class="o">=</span> <span class="nx">footer</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$todoCount</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$filters</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$clear</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Put all the parts together.</p>

<p>jQuery objects have <code>hoe()</code> method that is similar to HTML
creation functioins, but use an existing element.
Plain objects become HTML attributes, string and other DOM
elements are append to the content.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#todoapp&#39;</span> <span class="p">).</span><span class="nx">hoe</span><span class="p">(</span> <span class="nx">header</span><span class="p">(</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s1">&#39;header&#39;</span><span class="p">},</span> <span class="nx">h1</span><span class="p">(</span> <span class="s1">&#39;todos&#39;</span> <span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span> <span class="p">),</span>
               <span class="k">this</span><span class="p">.</span><span class="nx">$main</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span> <span class="p">),</span>
               <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;footer&#39;</span> <span class="p">)</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Create a group of elements that will be hidden when todo list is empty.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">$hide_empty</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$footer</span> <span class="p">).</span><span class="nx">add</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$main</span> <span class="p">).</span><span class="nx">hide</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Attach event handler for haschange in the URL</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">),</span> <span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">hashChanged</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><code>render_filter</code> create HTML for filter options.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render_filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">path</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$link</span> <span class="o">=</span> <span class="nx">a</span><span class="p">(</span> <span class="p">{</span><span class="nx">href</span><span class="o">:</span> <span class="s1">&#39;#/&#39;</span> <span class="o">+</span> <span class="nx">path</span> <span class="p">},</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span> <span class="p">);</span>
    <span class="nx">$link</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span> <span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">filter</span> <span class="o">==</span> <span class="nx">path</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="nx">$link</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">filter_opts</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">$ele</span> <span class="o">=</span> <span class="nx">$link</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$filters</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span> <span class="nx">li</span><span class="p">(</span> <span class="nx">$link</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <h3>hashChanged</h3>

<p>Read hash from URL and apply filter</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hashChanged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setFilter</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3>setFilter</h3>

<p>Change view to display only todo items that match the filter.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setFilter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">path</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>uptate propery</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>update UI</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$filters</span> <span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;selected&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">filter_opts</span><span class="p">[</span><span class="nx">path</span><span class="p">].</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;selected&#39;</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>apply filter to all TodoItem one by one.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterItem</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>the active filter also needs to be saved in LocalStorage</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h3>addItem</h3>

<p>Adds the TodoItem to the TodoApp and renders it.
This is used on initialization for items read from LocalStorage
and for items added through the UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">completed</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>create a new TodoItem</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TodoItem</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">completed</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Attach event handlers to TodoItem events.
The API is the same as used by DOM events,
just pass the object as first parameter instead of
a DOM element. Than comes the event name (<em>string</em>),
and the callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">deleteItem</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="s1">&#39;toggle&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemToggled</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">],</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">save</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">+=</span> <span class="nx">completed</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$todoList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">render</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">filterItem</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h3>updateCount</h3>

<p>Whenever an item is added or edited we need to refresh
the footer displaying the summary of items/completed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateCount</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">left_str</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">left</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">?</span> <span class="s1">&#39; item left&#39;</span> <span class="o">:</span> <span class="s1">&#39; items left&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$todoCount</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="nx">span</span><span class="p">(</span> <span class="nx">strong</span><span class="p">(</span> <span class="nx">left</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="p">),</span> <span class="nx">left_str</span> <span class="p">)</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$clear</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span> <span class="s1">&#39;Clear completed (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$clear</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <h3>addItemCallback</h3>

<p>Called when a new TodoItem is created from the UI</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addItemCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="nx">ENTER_KEY</span> <span class="o">&amp;&amp;</span> <span class="nx">title</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">next_id</span><span class="o">++</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span> <span class="s1">&#39;&#39;</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$hide_empty</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateCount</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h3>deleteItem</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deleteItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">-=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">completed</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">num_items</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$hide_empty</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateCount</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h3>filterItem</h3>

<p>Apply filter to a single item setting its visibility.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">filterItem</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">$ele</span><span class="p">.</span><span class="nx">toggle</span><span class="p">((</span> <span class="nx">item</span><span class="p">.</span><span class="nx">completed</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">filter_opts</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">].</span><span class="nx">value</span> <span class="p">));</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>itemToggled</h3>

<p>Event handler for TodoItem. Updates counter and applly filter on item</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">itemToggled</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">num_completed</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">completed</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">filterItem</span><span class="p">(</span> <span class="nx">item</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">updateCount</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <h3>toggleAll</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">checked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$toggleAll</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;checked&#39;</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">item</span><span class="p">.</span><span class="nx">completed</span> <span class="o">!==</span> <span class="nx">checked</span> <span class="p">){</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">$checkbox</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="nx">checked</span> <span class="p">);</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">toggleCompleted</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <h3>clearCompleted</h3>

<p>Delete all TodoItem that are completed.
Note: items are deleted one by one...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearCompleted</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">item</span><span class="p">.</span><span class="nx">completed</span> <span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">deleteItem</span><span class="p">(</span> <span class="nx">item</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>load</h3>

<p>This app saves the session data using LocaStorage.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span> <span class="s1">&#39;todos-hoejs&#39;</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">store</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>load list of TodoItem, filter, and next_id from LocaStorage</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span> <span class="nx">store</span> <span class="p">)</span> <span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">filter</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">next_id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">next_id</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>render the App (initially empty)</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>add the items read from the store</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">key</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$hide_empty</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updateCount</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h3>save</h3>

<p>save whole TodoApp on LocalStorage</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">TodoApp</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">todos</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">k</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">todos</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">v</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">completed</span> <span class="p">];</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">next_id</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">next_id</span><span class="p">,</span> <span class="nx">filter</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">todos</span><span class="o">:</span> <span class="nx">todos</span> <span class="p">};</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span> <span class="s1">&#39;todos-hoejs&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h2>create the application</h2>

<p>This tipically should be done in a separate file. But just following
TodoMVC guidelines...</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">new</span> <span class="nx">TodoApp</span><span class="p">();</span>
<span class="p">})(</span> <span class="nb">window</span> <span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
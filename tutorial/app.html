<!DOCTYPE html>

<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global location, localStorage, hoe */</span>
<span class="hljs-comment">/*global input, label, button, ul, li, div */</span>
<span class="hljs-comment">/*global h1, section, header, footer, strong, a, span */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="hoe-js-tutorial-todomvc">hoe.js Tutorial - TodoMVC</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>In this tutorial we will create a simple TODO application,
it is based on <a href="http://todomvc.com/">http://todomvc.com/</a>.
You can take a look at the full
<a href="https://github.com/addyosmani/todomvc/wiki/App-Specification">specification</a>
, but not required.</p>
<p>Before we start you can play with it <a href="../sample_todomvc/index.html">here</a>.</p>
<p>To run locally grab the source files for HTML, CSS and other dependencies
from the github
<a href="https://github.com/schettino72/hoe.js/tree/gh-pages/sample_todomvc">repo</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> APP; <span class="hljs-comment">// easy debug</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( window )</span> </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-keyword">var</span> ENTER_KEY = <span class="hljs-number">13</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="hoe-initialization">hoe initialization</h2>
<p>first call <code>hoe.init()</code> to define shorthand functions to
create HTML elements in the global namespace like <code>div()</code>,
<code>span()</code>, <code>a()</code>…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hoe.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="todoitem">TodoItem</h2>
<p>Let’s start writing code for a TodoItem,
our goal is to write it as a “component”.</p>
<p>It probably wont be re-used in any other place than
a TODO application, anyway this helps us structure the
the code in an easy way to understand and modify.</p>
<h2 id="hoe-component">hoe.Component</h2>
<p>Creates a <a href="https://github.com/Polymer/CustomElements">CustomElement</a>.
A CustomElment can be created in two ways:</p>
<p>1) programatically create by javascript
2) by HTML tags</p>
<p><code>hoe.Component</code> takes two parameters, the tag name and an initializer
function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> TodoItem = hoe.Component(<span class="hljs-string">'todo-item'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(args)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3 id="initializer">initializer</h3>
<p>An item has 3 properties: <code>id</code>, <code>title</code> and <code>completed</code>.
The TodoItem is created inheriting from <code>hoe.Type</code> so
it has some extra features (more on this features later on).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.id = args.id;
        <span class="hljs-keyword">this</span>.title = args.title;
        <span class="hljs-keyword">this</span>.completed = args.completed;
        <span class="hljs-keyword">this</span>.render();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="from_html">from_html</h2>
<p>When an custom element is created from HTML, use <code>from_html()</code>
to extract data from it and return an object that will be passed
as argument to the initializer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoItem.from_html = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">var</span> args = {};
        args.id = <span class="hljs-keyword">this</span>.getAttribute(<span class="hljs-string">'id'</span>);
        args.title = <span class="hljs-keyword">this</span>.textContent;
        args.completed = <span class="hljs-keyword">this</span>.getAttribute(<span class="hljs-string">'completed'</span>) === <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>remove title from DOM as actual DOM nodes will be
added later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">return</span> args;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><code>hoe.js</code> approach is that HTML for “widgets” should be created
directly by javascript.</p>
<p>But shouldn’t we separate the presentation from the logic with templates?
Well, using templates you would typically need to reference
mostly every element by <code>id</code> or <code>class</code> in order to attach events
and modify the element. So how much separation are you really getting
from this? Anyway, it is possible to use templates if you wish…</p>
<p>Creating HTML from js lets us simplify by keeping all the code
in a single location and avoid problems like referencing elements
by name that might have changed, have a typo or are simply
hard to locate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoItem.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <ul>
<li>create the <em>input</em> element for the checkbox calling the function
with the tag name</li>
<li>HTML attributes are passed as plain objects</li>
<li>the returned value is a jQuery object</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$checkbox = input({ <span class="hljs-string">'class'</span>: <span class="hljs-string">'toggle'</span>, type: <span class="hljs-string">'checkbox'</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>set the checkbox according to the instance value using jQuery method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$checkbox.checked = <span class="hljs-keyword">this</span>.completed;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Whenever a TodoItem is marked or unmarked as completed we need
to update our object’s data, so let’s attach an event handler.</p>
<p>The standard way to attach callbacks to events is to use the
method <code>listen</code>. This method is similar with jQuery’s <code>on</code> and
<code>bind</code>. The difference is that this method
belongs to the TodoItem object and the callback will be automatically
executed on the object scope (no need to use <code>$.proxy</code>).</p>
<p>the arguments are:</p>
<ul>
<li>the jQuery/DOM element that generates the event</li>
<li>the event name</li>
<li>the callback -&gt; (will be implemented later)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$checkbox, <span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.toggleCompleted );</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create <em>label</em> for checkbox with todo title and attach a
method to start editing on double click event.</p>
<p>Before we saw how plain objects are used to set HTML
attributes for a tag being created. If you pass a <em>String</em>
it will be append in the content of the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$label = label( {}, <span class="hljs-keyword">this</span>.title );
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$label, <span class="hljs-string">'dblclick'</span>, <span class="hljs-keyword">this</span>.startEdit );</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Create <em>button</em> to remove the TodoItem.
When a todo item is deleted it needs to be removed from
the TodoApp. Since the TodoItem has no knowlodge of
where it is contained it will just tigger/fire an event,
so that the container can act uppon it.</p>
<p>The fire method’s first argument is the name of the event.
All other arguments will be passed to the callback attached
as event handler, here we just pass a reference to the TodoItem
being deleted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> $button = button({ <span class="hljs-string">'class'</span>: <span class="hljs-string">'destroy'</span> });
        <span class="hljs-keyword">this</span>.listen( $button, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">this</span>.fire(<span class="hljs-string">'delete'</span>, <span class="hljs-keyword">this</span>);
        } );</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Here we create the <em>input</em> element to be used when the title
of the TodoItem is being edited.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$input = input({ <span class="hljs-string">'class'</span>: <span class="hljs-string">'edit'</span>, value:<span class="hljs-keyword">this</span>.title });
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$input, <span class="hljs-string">'blur'</span>, <span class="hljs-keyword">this</span>.updateTitle );
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$input, <span class="hljs-string">'keypress'</span>, <span class="hljs-keyword">this</span>.updateTitle );</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Now we just need to put all the elements together.
Note how we combine different arguments, plain object for
HTML attributes, DOM elements are appended to the content.
You can pass as many arguments as you wish.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> $view = div( {<span class="hljs-string">'class'</span>: <span class="hljs-string">'view'</span>},
                         <span class="hljs-keyword">this</span>.$checkbox, <span class="hljs-keyword">this</span>.$label, $button );
        <span class="hljs-keyword">this</span>.appendChild( $view);
        <span class="hljs-keyword">this</span>.appendChild( <span class="hljs-keyword">this</span>.$input );</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>And finally set a class to apply a CSS style.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.style.setProperty(<span class="hljs-string">'display'</span>, <span class="hljs-string">'block'</span>);
        <span class="hljs-keyword">this</span>.classList.toggle( <span class="hljs-string">'completed'</span>, <span class="hljs-keyword">this</span>.completed );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="event-handlers">Event handlers</h3>
<p>Now we need to create the methods used as event handlers
for each operation.</p>
<p><code>startEdit</code> will display the input element (done through CSS,
so just change the <code>class</code> attribute).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoItem.startEdit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.classList.add( <span class="hljs-string">'editing'</span> );
        <span class="hljs-keyword">this</span>.$input.focus();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><code>updateTitle</code> when finished editing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoItem.updateTitle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( e )</span></span>{
        <span class="hljs-keyword">if</span> ( e.type === <span class="hljs-string">'blur'</span> || e.keyCode === ENTER_KEY ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>update the Object property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.title = <span class="hljs-keyword">this</span>.$input.value = <span class="hljs-keyword">this</span>.$input.value.trim();</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>update the UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.$label.textContent = <span class="hljs-keyword">this</span>.title;
            <span class="hljs-keyword">this</span>.classList.remove( <span class="hljs-string">'editing'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>notify the container element triggering an event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.title ){
                <span class="hljs-keyword">this</span>.fire( <span class="hljs-string">'delete'</span>, <span class="hljs-keyword">this</span> );
            }
            <span class="hljs-keyword">this</span>.fire( <span class="hljs-string">'updated'</span> );
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>toggleCompleted</code>, about the same steps.
Update the object property, update the UI and trigger an event to
notify the container.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoItem.toggleCompleted = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.completed = <span class="hljs-keyword">this</span>.$checkbox.checked;
        <span class="hljs-keyword">this</span>.classList.toggle( <span class="hljs-string">'completed'</span> );
        <span class="hljs-keyword">this</span>.fire( <span class="hljs-string">'toggle'</span>, <span class="hljs-keyword">this</span> );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h2 id="todoapp">TodoApp</h2>
<p>The TodoApp will follow the same pattern.
The constructor defines the object properties, the initial data
is loaded from LocalStorage.
The URL hash can be used to set the initial “view filter”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> TodoApp = hoe.Component(<span class="hljs-string">'todo-app'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        APP = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>dict of TodoItem by id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.todos = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>helper to generate TodoItem id’s</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.next_id = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>computed values. keep track of number of TodoItem’s and completed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.num_completed = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.num_items = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>current value of the UI filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.filter = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">this</span>.filter_opts = {<span class="hljs-string">''</span>: { title: <span class="hljs-string">'All'</span>, value: <span class="hljs-literal">null</span> },
                            <span class="hljs-string">'active'</span>: { title: <span class="hljs-string">'Active'</span>, value: <span class="hljs-literal">true</span> },
                            <span class="hljs-string">'completed'</span>: { title: <span class="hljs-string">'Completed'</span>, value: <span class="hljs-literal">false</span> }};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Initialization: load data from LocalStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.load();</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>add elements from HTML</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.forArray(<span class="hljs-keyword">this</span>.extra, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(todo_item)</span></span>{
            <span class="hljs-keyword">this</span>.addItem(todo_item);
        });

        <span class="hljs-keyword">this</span>.updateCount();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.num_items){
            <span class="hljs-keyword">this</span>.$footer.style.display = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">this</span>.$main.style.display = <span class="hljs-string">''</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>read hash from URL to set initial filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.hashChanged();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>It is possible to directly modify the object instead of passing
arguments to the initializer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.from_html = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">this</span>.extra = [];
        <span class="hljs-keyword">var</span> items = <span class="hljs-keyword">this</span>.getElementsByTagName(<span class="hljs-string">'todo-item'</span>);
        <span class="hljs-keyword">this</span>.forArray(items, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(todo_item)</span></span>{
            <span class="hljs-keyword">this</span>.extra.push(todo_item);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h3 id="render">render</h3>
<p>create HTMl elements and attach events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>the input element where new TodoItem can be added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$input = input({ id: <span class="hljs-string">'new-todo'</span>,
                              placeholder: <span class="hljs-string">'What needs to be done?'</span>,
                              autofocus: <span class="hljs-string">''</span> });
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$input, <span class="hljs-string">'keyup'</span>, <span class="hljs-keyword">this</span>.createItemCallback );</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>checkbox to toggle all Todo’s at once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$toggleAll = input({ id:<span class="hljs-string">'toggle-all'</span>, type:<span class="hljs-string">'checkbox'</span> });
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$toggleAll, <span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.toggleAll );
        <span class="hljs-keyword">var</span> $label = label( { <span class="hljs-string">'for'</span>: <span class="hljs-string">'toggle-all'</span> }, <span class="hljs-string">'Mark all as complete'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>the container for the TodoItem’s HTML</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$todoList = ul({ id:<span class="hljs-string">'todo-list'</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>assemble the main section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$main = section( {<span class="hljs-string">'id'</span>:<span class="hljs-string">'main'</span>},  <span class="hljs-keyword">this</span>.$toggleAll,
                              $label, <span class="hljs-keyword">this</span>.$todoList);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>create the footer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$todoCount = span({ id: <span class="hljs-string">'todo-count'</span> });
        <span class="hljs-keyword">this</span>.$filters = ul( { id: <span class="hljs-string">'filters'</span> } );</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>A separate function was defined to create the HTML
for the filters.</p>
<p>the <code>forDict</code> method from <code>hoe.Type</code> will iterate through
the items of an array/object and pass them as a parameter
to a function. The function will automatically keep the scope
in the object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.forDict(<span class="hljs-keyword">this</span>.filter_opts, <span class="hljs-keyword">this</span>.render_filter);
        <span class="hljs-keyword">this</span>.$clear = button({ id: <span class="hljs-string">'clear-completed'</span> });
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.$clear, <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.clearCompleted );
        <span class="hljs-keyword">this</span>.$footer = footer( {<span class="hljs-string">'id'</span>: <span class="hljs-string">'footer'</span>},
                               <span class="hljs-keyword">this</span>.$todoCount, <span class="hljs-keyword">this</span>.$filters, <span class="hljs-keyword">this</span>.$clear );</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Put all the parts together.</p>
<p>jQuery objects have <code>hoe()</code> method that is similar to HTML
creation functioins, but use an existing element.
Plain objects become HTML attributes, string and other DOM
elements are append to the content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hoe.html(
            <span class="hljs-keyword">this</span>,
            header( {id:<span class="hljs-string">'header'</span>}, h1( <span class="hljs-literal">null</span>, <span class="hljs-string">'todos'</span> ), <span class="hljs-keyword">this</span>.$input ),
            <span class="hljs-keyword">this</span>.$main, <span class="hljs-keyword">this</span>.$footer
        );
        <span class="hljs-keyword">this</span>.style.display = <span class="hljs-string">'block'</span>;

        <span class="hljs-keyword">this</span>.$footer.style.display = <span class="hljs-string">'none'</span>;
        <span class="hljs-keyword">this</span>.$main.style.display = <span class="hljs-string">'none'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Attach event handler for haschange in the URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.listen(<span class="hljs-built_in">window</span>, <span class="hljs-string">'hashchange'</span>, <span class="hljs-keyword">this</span>.hashChanged);

    };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><code>render_filter</code> create HTML for filter options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.render_filter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, path )</span> </span>{
        <span class="hljs-keyword">var</span> $link = a( {href: <span class="hljs-string">'#/'</span> + path }, data.title );
        $link.classList.toggle( <span class="hljs-string">'selected'</span>, ( <span class="hljs-keyword">this</span>.filter == path) );
        <span class="hljs-keyword">this</span>.listen( $link, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.setFilter(path);
        });
        <span class="hljs-keyword">this</span>.filter_opts[path].$ele = $link;
        <span class="hljs-keyword">this</span>.$filters.appendChild( li( <span class="hljs-literal">null</span>, $link ) );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h3 id="hashchanged">hashChanged</h3>
<p>Read hash from URL and apply filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.hashChanged = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> ( location.hash ) {
            <span class="hljs-keyword">this</span>.setFilter(location.hash.substring(<span class="hljs-number">2</span>));
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h3 id="setfilter">setFilter</h3>
<p>Change view to display only todo items that match the filter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.setFilter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( path )</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>uptate propery</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.filter = path;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>update UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> $items = <span class="hljs-keyword">this</span>.$filters.getElementsByTagName(<span class="hljs-string">'a'</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>,max=$items.length;i&lt;max;i++){
            $items[i].classList.remove(<span class="hljs-string">'selected'</span>);
        }
        <span class="hljs-keyword">this</span>.filter_opts[path].$ele.classList.add( <span class="hljs-string">'selected'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>apply filter to all TodoItem one by one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.forDict( <span class="hljs-keyword">this</span>.todos, <span class="hljs-keyword">this</span>.filterItem );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>the active filter also needs to be saved in LocalStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.save();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h3 id="createitem">createItem</h3>
<p>Create new TodoItem and add them to the TodoApp.
This is used on initialization for items read from LocalStorage
and for items added through the UI.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.createItem = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( id, title, completed )</span> </span>{
        <span class="hljs-keyword">var</span> item = TodoItem.New({id:id, title:title, completed:completed});
        <span class="hljs-keyword">this</span>.addItem(item);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3 id="additem">addItem</h3>
<p>Adds the TodoItem to the TodoApp and renders it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.addItem = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( item )</span> </span>{
        <span class="hljs-keyword">var</span> id = item.id;
        <span class="hljs-keyword">if</span> (id <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.todos) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">this</span>.todos[id] = item;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Attach event handlers to TodoItem events.
The API is the same as used by DOM events,
just pass the object as first parameter instead of
a DOM element. Than comes the event name (<em>string</em>),
and the callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.todos[id], <span class="hljs-string">'delete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
            <span class="hljs-keyword">this</span>.deleteItem(event.detail);
        });
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.todos[id], <span class="hljs-string">'toggle'</span>, <span class="hljs-keyword">this</span>.itemToggled );
        <span class="hljs-keyword">this</span>.listen( <span class="hljs-keyword">this</span>.todos[id], <span class="hljs-string">'updated'</span>, <span class="hljs-keyword">this</span>.save );
        <span class="hljs-keyword">this</span>.num_items += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.num_completed += item.completed ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.$todoList.appendChild( <span class="hljs-keyword">this</span>.todos[id] );
        <span class="hljs-keyword">this</span>.filterItem( <span class="hljs-keyword">this</span>.todos[id] );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h3 id="updatecount">updateCount</h3>
<p>Whenever an item is added or edited we need to refresh
the footer displaying the summary of items/completed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.updateCount = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> left = <span class="hljs-keyword">this</span>.num_items - <span class="hljs-keyword">this</span>.num_completed;
        <span class="hljs-keyword">var</span> left_str = ( left == <span class="hljs-number">1</span> ) ? <span class="hljs-string">' item left'</span> : <span class="hljs-string">' items left'</span>;
        <span class="hljs-keyword">this</span>.$toggleAll.checked = (<span class="hljs-keyword">this</span>.num_completed === <span class="hljs-keyword">this</span>.num_items);
        hoe.html(<span class="hljs-keyword">this</span>.$todoCount,
                 span( <span class="hljs-literal">null</span>, strong( <span class="hljs-literal">null</span>, left.toString() ), left_str ) );
        hoe.html( <span class="hljs-keyword">this</span>.$clear,
                  <span class="hljs-string">'Clear completed ('</span> + <span class="hljs-keyword">this</span>.num_completed + <span class="hljs-string">')'</span> );
        <span class="hljs-keyword">this</span>.$clear.style.display = (<span class="hljs-keyword">this</span>.num_completed !== <span class="hljs-number">0</span>) ? <span class="hljs-string">''</span> : <span class="hljs-string">'none'</span>;
        <span class="hljs-keyword">this</span>.save();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <h3 id="createitemcallback">createItemCallback</h3>
<p>Called when a new TodoItem is created from the UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.createItemCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( e )</span> </span>{
        <span class="hljs-keyword">var</span> title = <span class="hljs-keyword">this</span>.$input.value.trim();
        <span class="hljs-keyword">if</span> ( e.which === ENTER_KEY &amp;&amp; title ) {
            <span class="hljs-keyword">var</span> id = <span class="hljs-keyword">this</span>.next_id++;
            <span class="hljs-keyword">this</span>.createItem( id, title, <span class="hljs-literal">false</span> );
            <span class="hljs-keyword">this</span>.$input.value = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">this</span>.$footer.style.display = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">this</span>.$main.style.display = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">this</span>.updateCount();
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h3 id="deleteitem">deleteItem</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.deleteItem = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( item )</span> </span>{
        <span class="hljs-keyword">this</span>.num_items -= <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.num_completed -= item.completed ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.num_items === <span class="hljs-number">0</span> ){
            <span class="hljs-keyword">this</span>.$footer.style.display = <span class="hljs-string">'none'</span>;
            <span class="hljs-keyword">this</span>.$main.style.display = <span class="hljs-string">'none'</span>;
        }
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.todos[item.id];
        hoe.remove(item);
        <span class="hljs-keyword">this</span>.updateCount();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="filteritem">filterItem</h3>
<p>Apply filter to a single item setting its visibility.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.filterItem = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( item )</span> </span>{
        <span class="hljs-keyword">var</span> display = item.completed != <span class="hljs-keyword">this</span>.filter_opts[<span class="hljs-keyword">this</span>.filter].value;
        item.style.display = display ? <span class="hljs-string">''</span> : <span class="hljs-string">'none'</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h3 id="itemtoggled">itemToggled</h3>
<p>Event handler for TodoItem. Updates counter and applly filter on item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.itemToggled = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> </span>{
        <span class="hljs-keyword">var</span> item = event.detail;
        <span class="hljs-keyword">this</span>.num_completed += item.completed ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.filterItem( item );
        <span class="hljs-keyword">this</span>.updateCount();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h3 id="toggleall">toggleAll</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.toggleAll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> checked = <span class="hljs-keyword">this</span>.$toggleAll.checked;
        <span class="hljs-keyword">this</span>.forDict( <span class="hljs-keyword">this</span>.todos, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( item )</span></span>{
            <span class="hljs-keyword">if</span> ( item.completed !== checked ){
                item.$checkbox.checked = checked;
                item.toggleCompleted();
            }
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h3 id="clearcompleted">clearCompleted</h3>
<p>Delete all TodoItem that are completed.
Note: items are deleted one by one…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.clearCompleted = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">this</span>.forDict( <span class="hljs-keyword">this</span>.todos, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( item )</span></span>{
            <span class="hljs-keyword">if</span> ( item.completed ){
                <span class="hljs-keyword">this</span>.deleteItem( item );
            }
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h3 id="load">load</h3>
<p>This app saves the session data using LocaStorage.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.load = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> store = localStorage.getItem( <span class="hljs-string">'todos-hoejs'</span> );
        <span class="hljs-keyword">if</span> ( store ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>load list of TodoItem, filter, and next_id from LocaStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> data = ( <span class="hljs-built_in">JSON</span>.parse( store ) );
            <span class="hljs-keyword">this</span>.filter = data.filter;
            <span class="hljs-keyword">this</span>.next_id = data.next_id;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>render the App (initially empty)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.render();</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>add the items read from the store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.forDict( data.todos, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( value, key )</span> </span>{
                <span class="hljs-keyword">this</span>.$footer.style.display = <span class="hljs-string">''</span>;
                <span class="hljs-keyword">this</span>.$main.style.display = <span class="hljs-string">''</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value[<span class="hljs-number">1</span>] != <span class="hljs-string">'boolean'</span>){
                    value[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>throw ‘db corrupted!’;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                }
                <span class="hljs-keyword">this</span>.createItem( key, value[<span class="hljs-number">0</span>], value[<span class="hljs-number">1</span>]);
            });
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.render();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h3 id="save">save</h3>
<p>save whole TodoApp on LocalStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TodoApp.save = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> todos = {};
        <span class="hljs-keyword">this</span>.forDict( <span class="hljs-keyword">this</span>.todos, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( v, k )</span> </span>{
            todos[k] = [ v.title, v.completed ];
        });
        <span class="hljs-keyword">var</span> data = { next_id: <span class="hljs-keyword">this</span>.next_id, filter: <span class="hljs-keyword">this</span>.filter, todos: todos };
        localStorage.setItem( <span class="hljs-string">'todos-hoejs'</span>, <span class="hljs-built_in">JSON</span>.stringify( data ) );
    };

})( <span class="hljs-built_in">window</span> );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
